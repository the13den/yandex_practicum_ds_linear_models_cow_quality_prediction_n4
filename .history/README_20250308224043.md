# О работе

# Вывод по работе, написанный в конце файла .ipynb


# ТЗ
Проект: Линейные модели в машинном обучении
Поздравляем! Вы прошли курс «Линейные модели в машинном обучении». Самое время проверить знания и решить новую задачу. Вы будете выполнять работу самостоятельно.
Когда закончите, отправьте её на проверку ревьюеру: он пришлёт комментарии в течение суток. После этого нужно доработать проект и пройти повторную проверку, если это будет необходимо.
Скорее всего, вы будете дорабатывать кейс по комментариям ещё несколько раз. Это нормально.
Проект завершён, когда ревьюер одобрил все доработки.
Описание проекта
Вы работаете в IT-компании, которая выполняет на заказ проекты по машинному обучению. К вам обратился фермер, владелец молочного хозяйства «Вольный луг». Он хочет купить бурёнок, чтобы расширить поголовье стада коров. Для этого он заключил выгодный контракт с ассоциацией пастбищ «ЭкоФерма».
Условия позволяют фермеру очень тщательно отобрать коров. Он определяет качество молока по строгой методике, и при этом ему нужно выполнять свой план развития молочного хозяйства. Фермер хочет, чтобы каждая бурёнка давала не менее 6000 килограммов молока в год, а её надой был вкусным — строго по его критериям, ничуть не хуже. А продавцы и технологи так и норовят приукрасить своих коровок!
Поэтому он просит вас разработать модель машинного обучения, которая поможет ему управлять рисками и принимать объективное решение о покупке. «ЭкоФерма» готова предоставить подробные данные о своих коровах. Вам нужно создать две прогнозные модели для отбора бурёнок в поголовье:
Первая будет прогнозировать возможный удой коровы (целевой признак Удой);
Вторая — рассчитывать вероятность получить вкусное молоко от коровы (целевой признак Вкус молока).
С помощью модели нужно отобрать коров по двум критериям:
средний удой за год — не менее 6000 килограммов;
молоко должно быть вкусным.
Описание данных
Для студентов, начавших работу над проектом до 18:00 6 октября 2023 года

Вы будете работать с тремя датасетами:
ferma_main.csv
ferma_dad.csv
cow_buy.csv
Вы можете их скачать, нажав на название каждого.
Файл ferma_main.csv содержит данные о стаде фермера на текущий момент. Описание данных:
id — уникальный идентификатор коровы.
Удой, кг — масса молока, которую корова даёт в год (в килограммах).
ЭКЕ (Энергетическая кормовая единица) — показатель питательности корма коровы.
Сырой протеин, г — содержание сырого протеина в корме (в граммах).
СПО (Сахаро-протеиновое соотношение) — отношение сахара к протеину в корме коровы.
Порода — порода коровы.
Тип пастбища — ландшафт лугов, на которых паслась корова.
порода папы_быка — порода папы коровы.
Жирность,% — содержание жиров в молоке (в процентах).
Белок,% — содержание белков в молоке (в процентах).
Вкус молока — оценка вкуса по личным критериям фермера, бинарный признак (вкусно, не вкусно).
Возраст — возраст коровы, бинарный признак (менее_2_лет, более_2_лет).
Признаки в датасете ferma_main.csv можно разделить на группы.
Характеристики коровы: id, Порода, порода папы_быка, Возраст.
Характеристики корма: ЭКЕ (Энергетическая кормовая единица), Сырой протеин, г, СПО (Сахаро-протеиновое соотношение).
Характеристика пастбища: Тип пастбища.
Характеристики молока: Удой, кг, Жирность,%, Белок,%, Вкус молока.
Такое разделение поможет вам понять, как взаимосвязаны признаки в датасете.
Файл ferma_dad.csv хранит имя папы каждой коровы в стаде фермера. Описание данных:
id — уникальный идентификатор коровы.
Имя Папы — имя папы коровы.
Файл cow_buy.csv — это данные о коровах «ЭкоФермы», которых фермер хочет изучить перед покупкой. Описание данных:
Порода — порода коровы.
Тип пастбища — ландшафт лугов, на которых паслась корова.
порода папы_быка — порода папы коровы.
Имя_папы — имя папы коровы.
Текущая_жирность,% — содержание жиров в молоке (в процентах).
Текущий_уровень_белок,% — содержание белков в молоке (в процентах).
Возраст — возраст коровы, бинарный признак (менее_2_лет, более_2_лет).
Данные в файлах ferma_main.csv и cow_buy.csv похожи, но у датасета cow_buy.csv несколько особенностей.
Содержание белков и жиров в молоке указано на момент продажи — когда «ЭкоФерма» давала коровам свой корм.
Параметры корма ЭКЕ (Энергетическая кормовая единица), Сырой протеин, г и СПО (Сахаро-протеиновое соотношение) отсутствуют. Технологи заказчика пересмотрели подход к кормлению: для новых коров планируется увеличить значения каждого из этих параметров на 5%.
Кроме того, отсутствуют признаки Удой, кг и Вкус молока. Это целевые признаки, именно их предстоит предсказать!
Инструкция по выполнению проекта
Для исследовательского анализа данных и оценки качества моделей вы можете создавать и использовать функции. Они заметно упростят вам работу:
• вам не придётся постоянно повторять однотипный код и обновлять данные;
• вы уменьшите риск допустить ошибку в коде;
• ваш код будет более лаконичным и понятным;
• вы сможете использовать ваши функции для будущих проектов.
При проверке этого проекта ревьюеры не будут негативно оценивать отсутствие функций — используйте их по желанию.
Шаг 1. Загрузите и изучите данные
Загрузите данные в датафреймы pandas. Файлы можно скачать по ссылкам в описании, они даже доступны через пути:
/datasets/ferma_main.csv
/datasets/ferma_dad.csv
/datasets/cow_buy.csv
Для студентов, начавших работу над проектом до 18:00 6 октября 2023 года

Изучите данные. Определите, соответствуют ли они описанию задачи и изученным в прошлых спринтах стандартам оформления данных. При необходимости переименуйте столбцы.
Шаг 2. Предобработка данных
Проверьте данные на наличие пропусков и дубликатов. Узнайте, корректны ли типы данных у каждого признака. При необходимости устраните все проблемы с данными.
Шаг 3. Исследовательский анализ данных
Проведите статистический анализ всех признаков.
Постройте графики для каждого признака. Помните, что количественным и категориальным признакам подходят разные графики.
Сделайте выводы о данных:
напишите, заметили ли вы выбросы, необычное распределение количественных признаков или другие особенности;
расскажите, как вы планируете улучшить данные.
Шаг 4. Проведите корреляционный анализ признаков в датасете ferma_main.csv
Изучите взаимосвязь между признаками: рассчитайте коэффициенты корреляции между всеми признаками.
Постройте диаграммы рассеяния scatterplot для признака Удой, кг и всех количественных признаков с учётом значения категориальных признаков. Пример: диаграмма рассеяния для Удой, кг и Сырой протеин, г, цвет точек диаграммы отображает признак Порода. Учитывайте, что виды связи в подгруппах могут различаться — например, для разных пород.
Сделайте выводы о взаимосвязи признаков.
Какой тип взаимосвязи между целевым и входными признаками?
Есть ли нелинейные связи между целевым и входными признаками? Нужно ли вводить в модель дополнительные признаки, чтобы это учесть?
Наблюдается ли мультиколлинеарность между входными признаками?
Шаг 5. Задача регрессии
Вам предстоит обучить три модели простой линейной регрессии.
Подготовьте данные датасета ferma_main.csv и обучите на них первую модель LinearRegression.
Используйте в качестве целевого признак Удой, кг.
Отберите признаки, которые подходят для модели линейной регрессии, аргументируйте выбор. Опирайтесь не только на наличие или отсутствие линейной связи между признаками, но и на причинно-следственные связи между удоем коров и группами признаков из описания датасета.
Разбейте данные на тренировочную и тестовую выборки.
Кодируйте категориальные признаки с помощью OneHotEncoder.
Масштабируйте количественные признаки с помощью StandardScaler.
Обучите модель линейной регрессии на подготовленных данных.
Оцените качество модели на тестовой выборке: рассчитайте R², проанализируйте остатки с помощью графиков.
Оформите выводы, укажите:
значение R² модели;
какие выводы следуют из анализа остатков;
нужны ли дополнительные исследования.
Подготовьте данные с учётом связи входных признаков с целевым и обучите на них вторую модель LinearRegression.
Посмотрите на диаграммы рассеяния: на них можно увидеть, что некоторые входные признаки связаны с целевым нелинейно. Исключите нелинейность, чтобы эти признаки были информативны для линейной регрессии. Вот несколько способов, которыми это можно сделать:
Вы обнаружите, что СПО и Удой связаны нелинейно. На их диаграмме рассеяния наблюдения сгруппированы в два кластера, причём есть такое значение СПО, которое можно считать границей между кластерами. Чтобы устранить нелинейность, преобразуйте СПО в категориальный бинарный признак, использовав эту границу.
Вы обнаружите, что ЭКЕ и Удой также связаны нелинейно. Нелинейность между ними можно исключить, если ввести новый признак ЭКЕ в квадрате.
Повторите шаги из пункта 1 и создайте вторую модель: подготовьте данные, обучите модель, оцените её качество и напишите выводы.
Добавьте в данные новый признак и обучите на них третью модель LinearRegression.
Добавьте признак Имя Папы из файла ferma_dad.csv, соединив его с остальными данными ferma_main.csv по ключу.
Устраните нелинейность между признаками.
Повторите шаги из пункта 1 и создайте третью модель: подготовьте данные, обучите модель, оцените её качество и напишите выводы.
Сравните качество трёх моделей линейной регрессии, сопоставьте их R² и остатки.
Оцените качество каждой модели по трём метрикам: MSE, MAE, RMSE. Используйте функции для расчёта метрик.
Выберите лучшую модель;
Укажите доверительный интервал прогноза лучшей модели. Для этого рассчитайте квантили ошибки модели на тренировочных данных.
С помощью лучшей модели спрогнозируйте удой коров, которых фермер хочет купить. Данные о них находятся в датасете cow_buy.csv.
Добавьте недостающие признаки ЭКЕ (Энергетическая кормовая единица), Сырой протеин, г и СПО (Сахаро-протеиновое соотношение): возьмите из датасета ferma_main.csv средние значения каждого из признаков и увеличьте их на 5%.
Выполните подготовку данных, аналогичную той, которую делали для тренировочной выборки.
Получите прогноз удоя коров.
Шаг 6. Задача классификации
Подготовьте данные датасета ferma_main.csv и обучите на них модель LogisticRegression.
Используйте в качестве целевого признак Вкус молока.
При необходимости преобразуйте имеющиеся или добавьте новые признаки.
Разбейте данные на тренировочную и тестовую выборки.
Кодируйте категориальные признаки с помощью OneHotEncoder.
Масштабируйте количественные признаки с помощью StandardScaler.
Обучите модель логистической регрессии на подготовленных данных.
Оцените качество модели на тестовой выборке: рассчитайте метрики accuracy, recall, precision.
Постройте матрицу ошибок.
Проанализируйте модель логистической регрессии.
Объясните, какая ошибка критичнее всего при покупке коров: первого или второго рода. Помните, что главное для заказчика — вкусное молоко. Сформулируйте ответ с учётом метрик recall и precision, выберите более важную из них.
Сведите критичную ошибку к нулю: для этого измените порог принадлежности к классам. Ещё раз рассчитайте значения метрик recall и precision. Какое значение порога вы выбрали? Как изменились значения метрик?
Оформите выводы: скажите, что нужно сделать дальше, исходя из анализа модели?
С помощью обученной модели спрогнозируйте вкус молока коров, которых фермер хочет купить. Данные о них находятся в датасете cow_buy.csv.
Выполните подготовку данных, аналогичную той, которую делали для тренировочной выборки.
Получите прогноз вкуса молока коров.
Шаг 7. Сделайте итоговые выводы
Добавьте прогнозы вкуса молока и удоя коров «ЭкоФермы» в датафрейм с коровами, покупку которых рассматривает фермер.
Отберите коров, для которых спрогнозирован удой более 6000 килограммов в год и вкусное молоко.
Коротко опишите результаты работы моделей для фермера.
Сколько коров он может купить из стада на продажу с минимальным риском для себя? Почему?
Какие ещё рекомендации можно ему дать?
Сделайте выводы о моделях линейной регрессии и логистической регрессии.
Какие способы улучшения качества регрессионной модели вы использовали в этой задаче?
Возможно ли ещё улучшить результаты регрессионной модели? Если можно, то как? Если нет, то почему?
Какие метрики моделей классификации, в том числе логистической регрессии, важны при анализе рисков или экономических расчётов?
Как будут проверять мой проект
Мы подготовили критерии оценки проекта, которыми руководствуются ревьюеры. Прежде чем приступить к решению кейса, внимательно их изучите. 
На что обращают внимание ревьюеры, проверяя проект:
как вы готовите данные к обучению, все ли особенности увидели и обрабатываете;
хорошо ли объясняете шаги по предобработке данных и исследовательскому анализу;
как проводите корреляционный анализ, проводите ли исследования в подгруппах;
используете ли при корреляционном анализе графики;
какие выводы об исследовании задачи делаете;
корректно ли разбиваете данные на выборки;
верно ли выбираете методы моделирования;
корректно ли проводите обучение;
корректно ли оцениваете модель по метрикам;
корректно ли исследуете остатки модели;
следите за структурой проекта и поддерживаете аккуратность кода;
правильно ли используете модели;
соблюдаете ли вы требования заказчика, даёте ли ему практические рекомендации.
Успехов!

# Технический комментарий
- Версия с опциональной критикой без правок
- Emerald