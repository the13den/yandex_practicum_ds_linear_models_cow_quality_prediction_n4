# О работе

# Вывод по работе, написанный в конце файла .ipynb

## Общий вывод
Работа состояла из следующих этапов. 

- Знакомство с данными и первичная предобработка
- Исследовательский анализ данных
- Корреляционный анализ признаков ferma_main с целевыми признаками
- Обучение модели линейной регрессии для предсказания Удоя
- Прогнозирование Удоя коров, планируемых к покупке с помощью лучшей созданной модели линейной регрессии
- Обучение модели логистической регрессии
- Прогнозирование Вкуса молока коров, планируемых к покупке с помощью модели логистической регрессии
- Выбор коров, которые приносят вкусное молоко и удой которых более 6000 кг в год

Ниже приведен вывод каждого этапа
### Знакомство с данными и первичная предобработка
Работа в этом разделе состояла из нескольких подразделов:
- **Первый взгляд на строки в таблицах**
- **Смена названий столбцов**
- **Изучение общей информации о данных в таблице, смена типов данных**
- **Первый взгляд на значения данных в каждом столбце каждой таблицы**

Ниже информация по каждому разделу:

**Первый взгляд на строки в таблицах**

В таблицах csv используется нестандартный разделитель ";" вместо ","

Также сразу видим, что столбцы названы неправильно. Общепринятый стандарт - отстутсвие заглавных букв, подчеркивания вместо пробелов, отстутсвие специсимволов, английский язык для слов.
Далее перименуем столбцы.
В категориальных колонках необходимо привести названия к нижнему регистру, заменить е (йо) на е, заменить пробелы и тире на _

**Смена названий столбцов**

В таблице `cow_buy`:

Названия столбцов были изменены следующим образом:

- `Порода`: `cow_breed`,
- `Тип пастбища`: `pasture_type`,
- `порода папы_быка`: `cow_dads_breed`,
- `Имя_папы`: `cow_dads_name`,
- `Текущая_жирность,%`: `milk_fatness`,
- `Текущий_уровень_белок,%`: `milk_protein`,
- `Возраст`: `cow_age`

В таблице `ferma_main`:

Названия столбцов были изменены следующим образом:

- `id`: `id`
- `Удой, кг`: `milk_yield_kg`
- `ЭКЕ (Энергетическая кормовая единица)`: `energy_feed_unit`
- `Сырой протеин, г`: `crude_protein_g`
- `СПО (Сахаро-протеиновое соотношение)`: `sugar_protein_ratio`
- `Порода`: `breed`
- `Тип пастбища`: `pasture_type`
- `порода папы_быка`: `cow_dads_breed`
- `Жирность,%`: `milk_fatness`
- `Белок,%`: `milk_protein`
- `Вкус молока`: `milk_taste`
- `Возраст`: `cow_age`
- `Имя Папы`: `cow_dads_name`

В таблице `ferma_dad`:

Названия столбцов были изменены следующим образом:

- `id`: `id`
- `Имя Папы`: `cow_dads_name`

**Изучение общей информации о данных в таблице, смена типов данных**

Видим, что список коров к покупке состоит из 20 коров (20 строк в `cow_buy`), в стаде фермера (`ferma_main` 634 строки) 634 коровы, имя отца коровы известно только для 629 коров (`ferma_dad` 629 строк)

В таблице `cow_buy` 

- в столбце `milk_fatness` сменен тип данных на числовой (float), 
- в столбце `milk_protein` сменен тип данных на числовой (float), 
- в столбце `age` сменен тип данных на числовой со значениями `1` и `0`, так как значения тут принимают только два вида: "больше 2", "меньше 2"

В таблице `ferma_main` 

- в столбце `energy_feed_unit` сменен тип данных на числовой (float), 
- в столбце `sugar_protein_ration` сменен тип данных на числовой (float), 
- в столбце `milk_fatness` сменен тип данных на числовой (float), 
- в столбце `milk_protein` сменен тип данных на числовой (float), 
- в столбце `age` сменен тип данных на числовой со значениями "1" и "0", так как значения тут принимают только два вида: "больше 2", "меньше 2"
- в столбце `milk_taste` сменен тип данных на бинарный (bool), так как значения тут принимают только два вида: "вкусно", "не вкусно"

**Первый взгляд на значения данных в каждом столбце каждой таблицы**

Данные в `cow_buy` и в `ferma_dad` выглядят адекватно

В таблице `ferma_main` есть много проблем. 
- В столбце `milk_yield_kg` таблицы максимкальный удой больше среднего в 6 раз
- В столбце `cow_dads_breed` таблицы дублируется одна и та же порода с разными названиями "Айдиалл" и "Айдиал"
- В столбце `pasture_type` таблицы дублируется один и тот же тип пастбища с разными названиями "равнинное" и "равнинные"
### Предобработка данных
Работа в этом разделе состояла из нескольких этапов

1. **"Удаление пропущенных значений"**
2. **"Удаление дубликатов"**
3. **"Смена типов данных"**
4. **"Изменение значений столбцов"**

**"Удаление пропущенных значений"** 

Пропущенные значения в каждом из столбцов в явном и неявном виде отсутствуют 

**"Удаление дубликатов"** 

До удаления в таблице было `cow_buy` 4 дубликатов
В остальных таблицах дубликаты не существовали. 

Также было проверено существование неявных дубликатов, они отсутсвуют

**"Смена типов данных"** 

Еще на этапе "Знакомство с данными" были проведены следующие смены типы данных. Сейчас везде данные принадлежат своему правильному типу данных 
В таблице `cow_buy` 

- в столбце `milk_fatness` сменен тип данных на числовой (float), 
- в столбце `milk_protein` сменен тип данных на числовой (float), 
- в столбце `age` сменен тип данных на числовой со значениями `1` и `0`, так как значения тут принимают только два вида: "больше 2", "меньше 2"

В таблице `ferma_main` 

- в столбце `energy_feed_unit` сменен тип данных на числовой (float), 
- в столбце `sugar_protein_ration` сменен тип данных на числовой (float), 
- в столбце `milk_fatness` сменен тип данных на числовой (float), 
- в столбце `milk_protein` сменен тип данных на числовой (float), 
- в столбце `age` сменен тип данных на числовой со значениями "1" и "0", так как значения тут принимают только два вида: "больше 2", "меньше 2"
- в столбце `milk_taste` сменен тип данных на бинарный (bool), так как значения тут принимают только два вида: "вкусно", "не вкусно"
  
**"Изменение значений столбцов"** 

  В таблице `ferma_main` в столбце `cow_dads_breed` породу с разными названиями "Айдиалл" и "Айдиал", превратили в одно одинаковое значение "Айдиал"
В таблице `ferma_main` в столбце `pasture_type`  тип пастбища с разными названиями "Равнинное" и "Равнинные", превратили в одно одинаковое значение "Равнинное

Переименовали русскоязычные значения в таблице `ferma_main` в категориальных столбцах для соответсвия формату snake_case. Это столбцы `cow_breed`, `pasture_type`, `cow_dads_breed`.

Cтолбец `cow_breed` 
Поменяли названия как
- 'Вис Бик Айдиал' -> "vis_bik_ideal"
- 'РефлешнСоверинг' -> "refleshn_sovering"

Cтолбец `pasture_type` 
Поменяли названия как
- 'равнинное' -> "plain"
- 'холмистое' -> "hilly"
  
Cтолбец `cow_dads_breed` 
Поменяли названия как
- 'Айдиал' -> "ideal"
- 'Соверин' -> "soverin"

Переименовали русскоязычные значения в таблице `cow_buy` в категориальных столбцах для соответсвия формату snake_case. Это столбцы `cow_breed`, `pasture_type`, `cow_dads_breed`, `cow_dads_name`

Cтолбец `cow_breed` 
Поменяли названия как
- 'Вис Бик Айдиал' -> "vis_bik_ideal"
- 'РефлешнСоверинг' -> "refleshn_sovering"

Cтолбец `pasture_type` 
Поменяли названия как
- 'равнинное' -> "plain"
- 'холмистое' -> "hilly"
  
Cтолбец `cow_dads_breed` 
Поменяли названия как
- 'Айдиал' -> "ideal"
- 'Соверин' -> "soverin"

Cтолбец `cow_dads_name`
Поменяли названия как

- 'Геркулес' -> "gercules" 
- 'Буйный' -> "buiniy" 
- 'Барин' -> "barin" 
- 'Соловчик' -> "solovchick" 

Переименовали русскоязычные значения в таблице `ferma_dad` в категориальных столбцах для соответсвия формату snake_case. Это столбцы `cow_dads_name`

Поменяли названия как

- 'Геркулес' -> "gercules" 
- 'Буйный' -> "buiniy" 
- 'Барин' -> "barin" 
- 'Соловчик' -> "solovchick" 
### Исследовательский анализ данных
Работа в данном разделе состояла из следующих этапов:
1. **"Исследовательский анализ данных в таблице `cow_buy`"**
2. **"Исследовательский анализ данных в таблице `ferma_main`"**
3. **"Исследовательский анализ данных в таблице `ferma_dad`"**

Пройдемся по каждому этапу

**"Исследовательский анализ данных в таблице `cow_buy`"** 


1. **Анализ количественных признаков**:
   - **Жирность молока (`milk_fatness`)**: 
     - Среднее значение составляет 3.57%, медиана — 3.59%. Распределение признака мультимодальное, с тремя пиками на уровнях 3.39, 3.6 и 3.75. Значения варьируются от 3.34% до 3.77%, что указывает на некоторую вариативность. Каждая характеристика выглядит адекватно и может существовать в реальности. Распределение `milk_fatness` мультимодальное, что может указывать на различные подгруппы коров, возможно, зависящие от породы, типа пастбища или других факторов. Это распределение имеет несколько пиков, что может быть связано с различиями в кормлении или генетических особенностях коров.
   - **Содержание белка в молоке (`milk_protein`)**:
     - Среднее значение равно 3.07%, медиана — 3.07%. Распределение похоже на скошенное нормальное, с тенденцией к 3.08% и отсутствием выбросов. Диапазон варьируется от 3.046% до 3.081%, что свидетельствует о высокой однородности. Распределение `milk_protein` похоже на нормальное, но с небольшим скошением, что может быть связано с высокой однородностью коров в выборке по этому признаку.

2. **Анализ категориальных признаков**:
   - **Породы коров (`cow_breed`)**: 
     - В выборке представлены 2 породы: `vis_bik_ideal` и `refleshn_sovering`, по 8 коров каждой породы.
   - **Тип пастбища (`pasture_type`)**:
     - В выборке коровы паслись на двух типах пастбищ: равнинные и холмистые, по 8 коров на каждом типе пастбища.
   - **Породы отца коров (`cow_dads_breed`)**:
     - Основные породы отцов: `soverin` (62.5%) и `refleshn_sovering` (37.5%).
   - **Имена отцов коров (`cow_dads_name`)**:
     - В стаде 31.2% коров от отца `gercules`, 43.8% от `buiniy`, 12.5% от `solovchick` и 12.5% от `barin`.
   - **Возраст коров (`cow_age`)**:
     - 68.8% коров старше 2-х лет, 31.2% младше 2-х лет.

Анализ данных таблицы `cow_buy` показывает, что большинство количественных признаков распределены нормально, хотя и с низкой вариативностью. 
Категориальные признаки имеют четко выраженные группы, что указывает на структурированность данных. Все данные выглядят адекватно и могут существовать в реальной жизни. Видим, что стоит глубже изучить взаимосвязи между категориями, чтобы лучше понять, какие факторы влияют на такие признаки, как жирность и содержание белка в молоке.


**"Исследовательский анализ данных в таблице `ferma_main`"** 

1. **Анализ количественных признаков**:
   - **Удой молока (`milk_yield_kg`)**:
     - Среднее значение: 6125.97 кг.
     - Медиана: 6132.50 кг.
     - Диапазон: от 5204.00 кг до 7222.00 кг. Максимальное значение значительно выше среднего, что может указывать на наличие выбросов.
     - Распределение похоже на нормальное, но с выбросами, которые влияют на верхний хвост распределения.
   - **Энергетическая кормовая единица (`energy_feed_unit`)**:
     - Среднее значение: 14.54.
     - Медиана: 14.70.
     - Диапазон: от 10.90 до 16.80. Распределение похоже на нормальное, с небольшим скошением вправо.
     - Видно, что значение часто принимает типовые табличные величины, что может объяснять наличие пиков в распределении.
   - **Сырой протеин (`crude_protein_g`)**:
     - Среднее значение: 1923.36 г.
     - Медиана: 1888.00 г.
     - Диапазон: от 1660.00 г до 2349.00 г.
     - Распределение показывает отголоски бимодальности, что может свидетельствовать о наличии двух типовых значений содержания протеина.
   - **Сахаро-протеиновое соотношение (`sugar_protein_ratio`)**:
     - Среднее значение: 0.913.
     - Медиана: 0.930.
     - Диапазон: от 0.840 до 0.960.
     - Распределение мультимодальное, с тремя основными пиками вокруг значений 0.84-0.86, 0.88-0.90, и 0.93-0.96.
   - **Жирность молока (`milk_fatness`)**:
     - Среднее значение: 3.60%.
     - Медиана: 3.65%.
     - Диапазон: от 2.99% до 3.75%.
     - Распределение бимодальное, с основным пиком на уровне 3.64-3.75%, и несколькими выбросами.
   - **Содержание белка в молоке (`milk_protein`)**:
     - Среднее значение: 3.08%.
     - Медиана: 3.08%.
     - Диапазон: от 3.069% до 3.085%.
     - Распределение нормально распределено вокруг значения 3.077%.

2. **Анализ категориальных признаков**:
   - **Породы коров (`cow_breed`)**:
     - В стаде представлены две породы: vis_bik_ideal (59.3%) и refleshn_sovering (40.7%).
   - **Тип пастбища (`pasture_type`)**:
     - 55.8% коров паслись на холмистых пастбищах, 44.2% — на равнинных.
   - **Породы отцов коров (`cow_dads_breed`)**:
     - Поголовье почти равномерно распределено между двумя породами отцов: ideal (50.6%) и soverin (49.4%).
   - **Вкус молока (`milk_taste`)**:
     - 59.0% коров дают вкусное молоко, 41.0% — невкусное.
   - **Возраст коров (`cow_age`)**:
     - 82.6% коров в стаде старше 2-х лет, 17.4% — младше 2-х лет.

Данные таблицы `ferma_main` показывают разнообразие в характеристиках поголовья фермера. Большинство количественных признаков имеют нормальное распределение, хотя в некоторых случаях наблюдаются выбросы или бимодальные распределения. Категориальные признаки также показывают структуру стада, где преобладают определенные породы, типы пастбищ, и возрастная категория старше 2-х лет. В целом, данные выглядят адекватными и могут быть использованы для дальнейшего анализа и построения моделей.

**"Исследовательский анализ данных в таблице `ferma_dad`"** 

В таблице ferma_dad есть только одна характеристика - имя отцов поголья.

**Анализ категориальных признаков:**  
`cow_dads_name`:

- **barin** — 38.2% коров в стаде происходят от отца barin.
- **buiniy** — 34.2% коров происходят от отца buiniy.
- **solovchick** — 17.5% коров происходят от отца solovchick.
- **gercules** — 10.2% коров происходят от отца gercules.

**Как улучшить данные?** 
Для каждого количественного признака можно сделать проверку на выбросы и удалить ихРабота в данном разделе состояла из следующих этапов:
1. **"Исследовательский анализ данных в таблице `cow_buy`"**
2. **"Исследовательский анализ данных в таблице `ferma_main`"**
3. **"Исследовательский анализ данных в таблице `ferma_dad`"**

Пройдемся по каждому этапу

**"Исследовательский анализ данных в таблице `cow_buy`"** 


1. **Анализ количественных признаков**:
   - **Жирность молока (`milk_fatness`)**: 
     - Среднее значение составляет 3.57%, медиана — 3.59%. Распределение признака мультимодальное, с тремя пиками на уровнях 3.39, 3.6 и 3.75. Значения варьируются от 3.34% до 3.77%, что указывает на некоторую вариативность. Каждая характеристика выглядит адекватно и может существовать в реальности. Распределение `milk_fatness` мультимодальное, что может указывать на различные подгруппы коров, возможно, зависящие от породы, типа пастбища или других факторов. Это распределение имеет несколько пиков, что может быть связано с различиями в кормлении или генетических особенностях коров.
   - **Содержание белка в молоке (`milk_protein`)**:
     - Среднее значение равно 3.07%, медиана — 3.07%. Распределение похоже на скошенное нормальное, с тенденцией к 3.08% и отсутствием выбросов. Диапазон варьируется от 3.046% до 3.081%, что свидетельствует о высокой однородности. Распределение `milk_protein` похоже на нормальное, но с небольшим скошением, что может быть связано с высокой однородностью коров в выборке по этому признаку.

2. **Анализ категориальных признаков**:
   - **Породы коров (`cow_breed`)**: 
     - В выборке представлены 2 породы: `vis_bik_ideal` и `refleshn_sovering`, по 8 коров каждой породы.
   - **Тип пастбища (`pasture_type`)**:
     - В выборке коровы паслись на двух типах пастбищ: равнинные и холмистые, по 8 коров на каждом типе пастбища.
   - **Породы отца коров (`cow_dads_breed`)**:
     - Основные породы отцов: `soverin` (62.5%) и `refleshn_sovering` (37.5%).
   - **Имена отцов коров (`cow_dads_name`)**:
     - В стаде 31.2% коров от отца `gercules`, 43.8% от `buiniy`, 12.5% от `solovchick` и 12.5% от `barin`.
   - **Возраст коров (`cow_age`)**:
     - 68.8% коров старше 2-х лет, 31.2% младше 2-х лет.

Анализ данных таблицы `cow_buy` показывает, что большинство количественных признаков распределены нормально, хотя и с низкой вариативностью. 
Категориальные признаки имеют четко выраженные группы, что указывает на структурированность данных. Все данные выглядят адекватно и могут существовать в реальной жизни. Видим, что стоит глубже изучить взаимосвязи между категориями, чтобы лучше понять, какие факторы влияют на такие признаки, как жирность и содержание белка в молоке.


**"Исследовательский анализ данных в таблице `ferma_main`"** 

1. **Анализ количественных признаков**:
   - **Удой молока (`milk_yield_kg`)**:
     - Среднее значение: 6125.97 кг.
     - Медиана: 6132.50 кг.
     - Диапазон: от 5204.00 кг до 7222.00 кг. Максимальное значение значительно выше среднего, что может указывать на наличие выбросов.
     - Распределение похоже на нормальное, но с выбросами, которые влияют на верхний хвост распределения.
   - **Энергетическая кормовая единица (`energy_feed_unit`)**:
     - Среднее значение: 14.54.
     - Медиана: 14.70.
     - Диапазон: от 10.90 до 16.80. Распределение похоже на нормальное, с небольшим скошением вправо.
     - Видно, что значение часто принимает типовые табличные величины, что может объяснять наличие пиков в распределении.
   - **Сырой протеин (`crude_protein_g`)**:
     - Среднее значение: 1923.36 г.
     - Медиана: 1888.00 г.
     - Диапазон: от 1660.00 г до 2349.00 г.
     - Распределение показывает отголоски бимодальности, что может свидетельствовать о наличии двух типовых значений содержания протеина.
   - **Сахаро-протеиновое соотношение (`sugar_protein_ratio`)**:
     - Среднее значение: 0.913.
     - Медиана: 0.930.
     - Диапазон: от 0.840 до 0.960.
     - Распределение мультимодальное, с тремя основными пиками вокруг значений 0.84-0.86, 0.88-0.90, и 0.93-0.96.
   - **Жирность молока (`milk_fatness`)**:
     - Среднее значение: 3.60%.
     - Медиана: 3.65%.
     - Диапазон: от 2.99% до 3.75%.
     - Распределение бимодальное, с основным пиком на уровне 3.64-3.75%, и несколькими выбросами.
   - **Содержание белка в молоке (`milk_protein`)**:
     - Среднее значение: 3.08%.
     - Медиана: 3.08%.
     - Диапазон: от 3.069% до 3.085%.
     - Распределение нормально распределено вокруг значения 3.077%.

2. **Анализ категориальных признаков**:
   - **Породы коров (`cow_breed`)**:
     - В стаде представлены две породы: vis_bik_ideal (59.3%) и refleshn_sovering (40.7%).
   - **Тип пастбища (`pasture_type`)**:
     - 55.8% коров паслись на холмистых пастбищах, 44.2% — на равнинных.
   - **Породы отцов коров (`cow_dads_breed`)**:
     - Поголовье почти равномерно распределено между двумя породами отцов: ideal (50.6%) и soverin (49.4%).
   - **Вкус молока (`milk_taste`)**:
     - 59.0% коров дают вкусное молоко, 41.0% — невкусное.
   - **Возраст коров (`cow_age`)**:
     - 82.6% коров в стаде старше 2-х лет, 17.4% — младше 2-х лет.

Данные таблицы `ferma_main` показывают разнообразие в характеристиках поголовья фермера. Большинство количественных признаков имеют нормальное распределение, хотя в некоторых случаях наблюдаются выбросы или бимодальные распределения. Категориальные признаки также показывают структуру стада, где преобладают определенные породы, типы пастбищ, и возрастная категория старше 2-х лет. В целом, данные выглядят адекватными и могут быть использованы для дальнейшего анализа и построения моделей.

**"Исследовательский анализ данных в таблице `ferma_dad`"** 

В таблице ferma_dad есть только одна характеристика - имя отцов поголья.

**Анализ категориальных признаков:**  
`cow_dads_name`:

- **barin** — 38.2% коров в стаде происходят от отца barin.
- **buiniy** — 34.2% коров происходят от отца buiniy.
- **solovchick** — 17.5% коров происходят от отца solovchick.
- **gercules** — 10.2% коров происходят от отца gercules.

**Как улучшить данные?** 
Для каждого количественного признака можно сделать проверку на выбросы и удалить их
### Корреляционный анализ признаков `ferma_main` с целевыми признаками
В ходе анализа корреляций между признаками набора данных `ferma_main` были построены тепловые карты для коэффициентов корреляции Пирсона и Фи. Эти матрицы позволили оценить, насколько сильно связаны между собой различные переменные. Приведем выводы для целевых переменных

1. **Корреляция Пирсона**:
   - **`milk_yield_kg` (Удой молока)**:
     - **Сильные корреляции**: Удой молока имеет сильную положительную корреляцию с `sugar_protein_ratio` (0.81) и `energy_feed_unit` (0.77). Это указывает на важность уровня энергетической кормовой единицы и соотношения сахара к протеину для удоя молока. 
     - **Умеренные корреляции**: Умеренная положительная корреляция с `milk_fatness` (0.60) предполагает, что более питательный корм может способствовать увеличению удоя молока.
     - **Слабые корреляции**: Практически отсутствует корреляция с `milk_protein` (0.00), что указывает на слабую связь между удоем молока и содержанием белка в молоке.

2. **Корреляция Фи**:
   - Корреляция Фи использовалась для оценки ассоциаций между категориальными и числовыми признаками. Результаты показали, что большинство категориальных признаков имеют слабые или умеренные ассоциации с числовыми переменными.
   - 1. **`milk_taste` (Вкус молока)**:
   - **Корреляция с `id`**: **0.05** - Очень слабая ассоциация, что указывает на отсутствие связи между идентификатором коровы и вкусом молока.
   - **Корреляция с `milk_yield_kg`**: **0.18** - Слабая положительная ассоциация, что может означать небольшую связь между удоем молока и его вкусовыми качествами.
   - **Корреляция с `energy_feed_unit`**: **0.27** - Слабая положительная ассоциация, что может указывать на слабую зависимость вкуса молока от питательности корма.
   - **Корреляция с `crude_protein_g`**: **0.17** - Слабая положительная ассоциация, что указывает на незначительное влияние содержания протеина в корме на вкус молока.
   - **Корреляция с `sugar_protein_ratio`**: **0.57** - Умеренная положительная ассоциация, что может означать, что соотношение сахара к протеину оказывает влияние на вкусовые качества молока.
   - **Корреляция с `cow_breed`**: **0.00** - Отсутствие ассоциации, что указывает на независимость вкуса молока от породы коровы.
   - **Корреляция с `pasture_type`**: **0.27** - Слабая положительная ассоциация, что может указывать на небольшое влияние типа пастбища на вкус молока.
   - **Корреляция с `cow_dads_breed`**: **0.00** - Отсутствие ассоциации, что указывает на отсутствие связи между породой отца и вкусом молока.
   - **Корреляция с `milk_fatness`**: **0.20** - Слабая положительная ассоциация, что указывает на незначительное влияние жирности молока на его вкус.
   - **Корреляция с `milk_protein`**: **0.15** - Слабая положительная ассоциация, что указывает на незначительное влияние содержания белка в молоке на его вкус.
   - **Корреляция с `cow_age`**: **0.17** - Слабая положительная ассоциация, что может означать небольшую связь между возрастом коровы и вкусовыми качествами молока.

2. **`milk_yield_kg` (Удой молока)**:
   - **Корреляция с `id`**: **0.00** - Отсутствие ассоциации, что указывает на независимость удоя от идентификатора коровы.
   - **Корреляция с `milk_yield_kg`**: **1.00** - Самая сильная положительная ассоциация, так как это корреляция самой переменной с собой.
   - **Корреляция с `energy_feed_unit`**: **0.72** - Сильная положительная ассоциация, что указывает на значительное влияние питательности корма на удой молока.
   - **Корреляция с `crude_protein_g`**: **0.47** - Умеренная положительная ассоциация, что указывает на связь между содержанием протеина в корме и удоем молока.
   - **Корреляция с `sugar_protein_ratio`**: **0.66** - Сильная положительная ассоциация, что подчеркивает важность соотношения сахара к протеину в корме для удоя молока.
   - **Корреляция с `cow_breed`**: **0.16** - Слабая положительная ассоциация, что указывает на небольшое влияние породы коровы на удой молока.
   - **Корреляция с `pasture_type`**: **0.28** - Слабая положительная ассоциация, что может указывать на влияние типа пастбища на удой молока.
   - **Корреляция с `cow_dads_breed`**: **0.52** - Умеренная положительная ассоциация, что может указывать на влияние породы отца коровы на удой молока.
   - **Корреляция с `milk_fatness`**: **0.71** - Сильная положительная ассоциация, что указывает на значительное влияние жирности молока на его удой.
   - **Корреляция с `milk_protein`**: **0.06** - Очень слабая положительная ассоциация, что указывает на независимость удоя от содержания белка в молоке.
   - **Корреляция с `milk_taste`**: **0.18** - Слабая положительная ассоциация, что может означать небольшую связь между удоем и вкусом молока.
   - **Корреляция с `cow_age`**: **1.00** - Сильнейшая положительная ассоциация, так как возраст коровы тесно связан с удоем.

**Примечание**
- Было замечено, что удой молока нелинейно зависит от показателя `sugar_protein_ratio` (СПО). Если значение СПО превышает 0.90, удой молока значительно увеличивается. Корелляция бинарного признака СПО > 09 `sugar_protein_ratio_more_09` с признаком "Удой" сильнее чем корелляция `sugar_protein_ratio` с этим же признаком. Для признака "Вкус молока" ситуация обратная `sugar_protein_ratio_more_09` кореллирует с ним слабее чем `sugar_protein_ratio`

- По графику видно, что Удой зависит от ЭКЕ нелинейно, чтобы устранить нелинейность нужно возвести ЭКЕ в квадрат.

- Учитывая, что коровы породы `soverin` и более старые коровы дают больше молока, эти признаки также должны быть дополнительно учтены при построении модели.

- Мультиколлинеарность отсутствует, что указывает на независимость рассмотренных признаков друг от друга.
### Обучение модели линейной регрессии для предсказания Удоя
Для обучения модели линейной регрессии выбраны следующие признаки, которые обладают наибольшей корреляцией с целевой переменной `milk_yield_kg` (удой молока). В модели использованы количественные признаки `energy_feed_unit`, `crude_protein_g`, `sugar_protein_ratio`, `milk_fatness`, и `milk_protein`, так как они показывают умеренную или сильную корреляцию по Пирсону с целевым признаком. Также были добавлены категориальные признаки `cow_dads_breed` и `cow_age`, которые имеют сильную или умеренную корреляцию по Фи. Признак `cow_breed` был включен на основе логического анализа, несмотря на слабую корреляцию.

**Различия между моделями**

Модель 1: Не учитывает данные о породе отца коров, не учитывает квадратичный признак, такой как `energy_feed_unit`^2 (ЭКЕ^2), категориальную характеристику, такую как `sugar_protein_ratio_more_09` (1, если СПО > 0.9, иначе 0).

Модель 2: Учитывает данные о породе отца коров, но, как и в модели 1, не учитывает квадратичный признак, такой как `energy_feed_unit`^2 (ЭКЕ^2), категориальную характеристику, такую как `sugar_protein_ratio_more_09` (1, если СПО > 0.9, иначе 0).

Модель 3: Включает как данные о породе отца коров, так и квадратичный признак, такой как `energy_feed_unit`^2 (ЭКЕ^2), категориальную характеристику, такую как `sugar_protein_ratio_more_09` (1, если СПО > 0.9, иначе 0).

**Анализ остатков**

Остатки модели 1: Гистограмма остатков показала, что модель не имеет ярко выраженной систематической ошибки, однако на графике рассеяния остатков видно, что ошибка модели возрастает при предсказании значений удоя свыше 6000 кг молока в год.

Остатки модели 2: Гистограмма остатков показывает небольшую асимметрию вправо, что указывает на то, что модель может слегка занижать предсказания. Аналогично модели 1, ошибка модели возрастает при предсказании значений свыше 6000 кг молока в год.

Остатки модели 3: Гистограмма остатков показывает, что распределение остатков не является скошенным, однако присутствуют выбросы. График рассеяния остатков выявил, что модель допускает ошибку при предсказании значений удоя свыше 6000 кг молока в год, но эта ошибка очень слабо выражена по сравнению с предыдущими моделями.

**Метрики каждой модели**

Модель 1:

- MAE: 161.78 кг
- MSE: 43,146.80 кг²
- RMSE: 207.72 кг

Модель 2:

- MAE: 153.03 кг
- MSE: 39,758.31 кг²
- RMSE: 199.39 кг

Модель 3:

- MAE: 144.94 кг
- MSE: 35,840.97 кг²
- RMSE: 189.32 кг

**Выбор лучшей модели и оценка ее доверительного интервала**

Сравнивая значения метрик, можно сделать вывод, что модель 3 показывает наилучшие результаты по всем трем метрикам. 

Для модели 3 был рассчитан доверительный интервал ошибок предсказаний. Таким образом ошибка модели в 90% случая будет лежать в диапазоне 598 кг. Из них только 5% ошибок меньше -278 кг, только 90% больше 320 кг

Модель 3 наиболее точно предсказывает удой молока, и ее предсказания имеют наименьшую ошибку по сравнению с другими моделями.

### Прогнозирование Удоя коров, планируемых к покупке с помощью лучшей созданной модели линейной регрессии
Был выполнен прогноз, все коровы из планируемых к покупке приносят больше 6000 кг молока в год. Данные сохранены в датасете cow_buy_best_yield_model_predict. Куда также добавлены данные о корме (средния значения с фермы фермера + 5%) характеристика ЭКЭ^2 и характеристика sugar_protein_ratio_more_09 (1, если СПО больше 0.9, иначе 0)
### Обучение модели логистической регрессии

Для обучения модели логистической регрессии были выбраны следующие признаки:

- `crude_protein_g`, `milk_fatness`, `milk_protein`: эти признаки слабо коррелируют с целевым признаком "Вкус молока", но были включены в модель, так как, по логике, могут влиять на вкус молока.
- `energy_feed_unit_squared`, `sugar_protein_ratio`: признаки с более выраженной корреляцией (0.31 и 0.57 по Пирсону соответственно), которые были добавлены для улучшения предсказательной способности модели.
- Категориальные переменные `cow_breed`, `cow_dads_breed`, `cow_dads_name`: несмотря на отсутствие явной корреляции по Фи, были включены в модель, поскольку порода и генетика могут существенно влиять на вкус молока.
- `pasture_type`, `cow_age`: были добавлены в модель, поскольку слабо коррелируют с целевым признаком по Фи и могут вносить значимый вклад.

Модель логистической регрессии была успешно обучена и протестирована. Изначальные метрики модели были следующими:

- Точность (Accuracy): 0.611
- Полнота (Recall): 0.852
- Точность (Precision): 0.610

После настройки порога для повышения точности (Precision), метрики изменились следующим образом:

- Точность (Accuracy): 0.611
- Полнота (Recall): 0.443
- Точность (Precision): 0.765

Таким образом, если модель определила молоко как вкусное, это верно в 76% случаев. Однако, ради повышения точности, модель отбрасывает 65% коров с действительно вкусным молоком, что существенно снижает полноту (Recall).

Такой подход обоснован тем, что для заказчика важнее избегать ошибок первого рода (ложноположительных результатов), когда модель неверно определяет молоко как вкусное. Таким образом, модель настроена на максимизацию точности (Precision), что снижает вероятность покупки коров с невкусным молоком.
```
### Прогнозирование Вкуса молока коров, планируемых к покупке с помощью модели логистической регрессии
Был выполнен прогноз, который представлен в разделе "Выбор коров, которые приносят вкусное молоко и удой которых более 6000 кг в год". Данные сохранены в датасете cow_buy_best_yield_model_predict.
### Выбор коров, которые приносят вкусное молоко и удой которых более 6000 кг в год
К покупке подходят коровы под индексами 0, 1, 2, 4, 7, 9, 11, 13, 15, 16, 18 из таблицы. Также в таблице видны параметры корма при которых были сделаны предсказания. Таблица приведена ниже. Она называется cow_buy_best_yield_model_predict

![2024-08-21_18-12-58.jpg](attachment:b736853f-7da4-47c9-9dee-1cfcd670749d.jpg)
## Рекомендации фермеру
Стоит использовать корм с высоким содержанием энергетической кормовой единицы (ЭКЕ) и поддерживать соотношение сахара к протеину (СПО) на уровне выше 0.90, так как это значительно влияет на удой молока.
Также стоит учитывать, что коровы породы Soverin и старше двух лет показали лучший удой.
Если давать рекомендации по сбору данных можно сказать, что очень желательным было бы:
- Тщательнее контролировать отсутвие дубликатов в категориальных столбцах. Например, в столбце "порода отца"
- Добавить проверку на глупость числовых значений так как в столбце удой, встречалось наблюдение с удоем превыщающим средний удой в 6 раз
- Придерживаться англоязычных наименований столбцов и формата snake_case
## Ответы на вопросы в задании проекта
__Какие способы улучшения качества регрессионной модели вы использовали в этой задаче?__

Для улучшения качества регрессионной модели в этой задаче использовались следующие методы:
- Отбор признаков на основании логики и корелляции
- добавление новых признаков
- стандартизацию данных
- настройка порога модели классификации


__Возможно ли ещё улучшить результаты регрессионной модели? Если можно, то как? Если нет, то почему?__ 

Да, результаты можно улучшить с помощью следующих подходов:
- Можно использовать другой метод стандартизации числовых величин
- Можно попробовать добавить больше полиномиальных признаков
- Можно проанализировать каждую количественную переменную на выбросы
- Можно использовать регуляризацию.

__Какие метрики моделей классификации, в том числе логистической регрессии, важны при анализе рисков или экономических расчётов?__ 

- Accuracy: Показывает общую долю верных прогнозов

- Precision: Особенно важен там, где ошибки первого рода (ложноположительные результаты) нужно максимально сильно избегать. Например, при анализе качества молока важно минимизировать количество случаев, когда корову с невкусным молоком определяют как корову с вкусным молоком.

- Recall: Важен в случаях, когда ошибки второго рода (ложноотрицательные результаты) нужно минимизировать. Например, если задача заключается в выявлении заболевания у человека. 


# ТЗ
Проект: Линейные модели в машинном обучении
Поздравляем! Вы прошли курс «Линейные модели в машинном обучении». Самое время проверить знания и решить новую задачу. Вы будете выполнять работу самостоятельно.
Когда закончите, отправьте её на проверку ревьюеру: он пришлёт комментарии в течение суток. После этого нужно доработать проект и пройти повторную проверку, если это будет необходимо.
Скорее всего, вы будете дорабатывать кейс по комментариям ещё несколько раз. Это нормально.
Проект завершён, когда ревьюер одобрил все доработки.
Описание проекта
Вы работаете в IT-компании, которая выполняет на заказ проекты по машинному обучению. К вам обратился фермер, владелец молочного хозяйства «Вольный луг». Он хочет купить бурёнок, чтобы расширить поголовье стада коров. Для этого он заключил выгодный контракт с ассоциацией пастбищ «ЭкоФерма».
Условия позволяют фермеру очень тщательно отобрать коров. Он определяет качество молока по строгой методике, и при этом ему нужно выполнять свой план развития молочного хозяйства. Фермер хочет, чтобы каждая бурёнка давала не менее 6000 килограммов молока в год, а её надой был вкусным — строго по его критериям, ничуть не хуже. А продавцы и технологи так и норовят приукрасить своих коровок!
Поэтому он просит вас разработать модель машинного обучения, которая поможет ему управлять рисками и принимать объективное решение о покупке. «ЭкоФерма» готова предоставить подробные данные о своих коровах. Вам нужно создать две прогнозные модели для отбора бурёнок в поголовье:
Первая будет прогнозировать возможный удой коровы (целевой признак Удой);
Вторая — рассчитывать вероятность получить вкусное молоко от коровы (целевой признак Вкус молока).
С помощью модели нужно отобрать коров по двум критериям:
средний удой за год — не менее 6000 килограммов;
молоко должно быть вкусным.
Описание данных
Для студентов, начавших работу над проектом до 18:00 6 октября 2023 года

Вы будете работать с тремя датасетами:
ferma_main.csv
ferma_dad.csv
cow_buy.csv
Вы можете их скачать, нажав на название каждого.
Файл ferma_main.csv содержит данные о стаде фермера на текущий момент. Описание данных:
id — уникальный идентификатор коровы.
Удой, кг — масса молока, которую корова даёт в год (в килограммах).
ЭКЕ (Энергетическая кормовая единица) — показатель питательности корма коровы.
Сырой протеин, г — содержание сырого протеина в корме (в граммах).
СПО (Сахаро-протеиновое соотношение) — отношение сахара к протеину в корме коровы.
Порода — порода коровы.
Тип пастбища — ландшафт лугов, на которых паслась корова.
порода папы_быка — порода папы коровы.
Жирность,% — содержание жиров в молоке (в процентах).
Белок,% — содержание белков в молоке (в процентах).
Вкус молока — оценка вкуса по личным критериям фермера, бинарный признак (вкусно, не вкусно).
Возраст — возраст коровы, бинарный признак (менее_2_лет, более_2_лет).
Признаки в датасете ferma_main.csv можно разделить на группы.
Характеристики коровы: id, Порода, порода папы_быка, Возраст.
Характеристики корма: ЭКЕ (Энергетическая кормовая единица), Сырой протеин, г, СПО (Сахаро-протеиновое соотношение).
Характеристика пастбища: Тип пастбища.
Характеристики молока: Удой, кг, Жирность,%, Белок,%, Вкус молока.
Такое разделение поможет вам понять, как взаимосвязаны признаки в датасете.
Файл ferma_dad.csv хранит имя папы каждой коровы в стаде фермера. Описание данных:
id — уникальный идентификатор коровы.
Имя Папы — имя папы коровы.
Файл cow_buy.csv — это данные о коровах «ЭкоФермы», которых фермер хочет изучить перед покупкой. Описание данных:
Порода — порода коровы.
Тип пастбища — ландшафт лугов, на которых паслась корова.
порода папы_быка — порода папы коровы.
Имя_папы — имя папы коровы.
Текущая_жирность,% — содержание жиров в молоке (в процентах).
Текущий_уровень_белок,% — содержание белков в молоке (в процентах).
Возраст — возраст коровы, бинарный признак (менее_2_лет, более_2_лет).
Данные в файлах ferma_main.csv и cow_buy.csv похожи, но у датасета cow_buy.csv несколько особенностей.
Содержание белков и жиров в молоке указано на момент продажи — когда «ЭкоФерма» давала коровам свой корм.
Параметры корма ЭКЕ (Энергетическая кормовая единица), Сырой протеин, г и СПО (Сахаро-протеиновое соотношение) отсутствуют. Технологи заказчика пересмотрели подход к кормлению: для новых коров планируется увеличить значения каждого из этих параметров на 5%.
Кроме того, отсутствуют признаки Удой, кг и Вкус молока. Это целевые признаки, именно их предстоит предсказать!
Инструкция по выполнению проекта
Для исследовательского анализа данных и оценки качества моделей вы можете создавать и использовать функции. Они заметно упростят вам работу:
• вам не придётся постоянно повторять однотипный код и обновлять данные;
• вы уменьшите риск допустить ошибку в коде;
• ваш код будет более лаконичным и понятным;
• вы сможете использовать ваши функции для будущих проектов.
При проверке этого проекта ревьюеры не будут негативно оценивать отсутствие функций — используйте их по желанию.
Шаг 1. Загрузите и изучите данные
Загрузите данные в датафреймы pandas. Файлы можно скачать по ссылкам в описании, они даже доступны через пути:
/datasets/ferma_main.csv
/datasets/ferma_dad.csv
/datasets/cow_buy.csv
Для студентов, начавших работу над проектом до 18:00 6 октября 2023 года

Изучите данные. Определите, соответствуют ли они описанию задачи и изученным в прошлых спринтах стандартам оформления данных. При необходимости переименуйте столбцы.
Шаг 2. Предобработка данных
Проверьте данные на наличие пропусков и дубликатов. Узнайте, корректны ли типы данных у каждого признака. При необходимости устраните все проблемы с данными.
Шаг 3. Исследовательский анализ данных
Проведите статистический анализ всех признаков.
Постройте графики для каждого признака. Помните, что количественным и категориальным признакам подходят разные графики.
Сделайте выводы о данных:
напишите, заметили ли вы выбросы, необычное распределение количественных признаков или другие особенности;
расскажите, как вы планируете улучшить данные.
Шаг 4. Проведите корреляционный анализ признаков в датасете ferma_main.csv
Изучите взаимосвязь между признаками: рассчитайте коэффициенты корреляции между всеми признаками.
Постройте диаграммы рассеяния scatterplot для признака Удой, кг и всех количественных признаков с учётом значения категориальных признаков. Пример: диаграмма рассеяния для Удой, кг и Сырой протеин, г, цвет точек диаграммы отображает признак Порода. Учитывайте, что виды связи в подгруппах могут различаться — например, для разных пород.
Сделайте выводы о взаимосвязи признаков.
Какой тип взаимосвязи между целевым и входными признаками?
Есть ли нелинейные связи между целевым и входными признаками? Нужно ли вводить в модель дополнительные признаки, чтобы это учесть?
Наблюдается ли мультиколлинеарность между входными признаками?
Шаг 5. Задача регрессии
Вам предстоит обучить три модели простой линейной регрессии.
Подготовьте данные датасета ferma_main.csv и обучите на них первую модель LinearRegression.
Используйте в качестве целевого признак Удой, кг.
Отберите признаки, которые подходят для модели линейной регрессии, аргументируйте выбор. Опирайтесь не только на наличие или отсутствие линейной связи между признаками, но и на причинно-следственные связи между удоем коров и группами признаков из описания датасета.
Разбейте данные на тренировочную и тестовую выборки.
Кодируйте категориальные признаки с помощью OneHotEncoder.
Масштабируйте количественные признаки с помощью StandardScaler.
Обучите модель линейной регрессии на подготовленных данных.
Оцените качество модели на тестовой выборке: рассчитайте R², проанализируйте остатки с помощью графиков.
Оформите выводы, укажите:
значение R² модели;
какие выводы следуют из анализа остатков;
нужны ли дополнительные исследования.
Подготовьте данные с учётом связи входных признаков с целевым и обучите на них вторую модель LinearRegression.
Посмотрите на диаграммы рассеяния: на них можно увидеть, что некоторые входные признаки связаны с целевым нелинейно. Исключите нелинейность, чтобы эти признаки были информативны для линейной регрессии. Вот несколько способов, которыми это можно сделать:
Вы обнаружите, что СПО и Удой связаны нелинейно. На их диаграмме рассеяния наблюдения сгруппированы в два кластера, причём есть такое значение СПО, которое можно считать границей между кластерами. Чтобы устранить нелинейность, преобразуйте СПО в категориальный бинарный признак, использовав эту границу.
Вы обнаружите, что ЭКЕ и Удой также связаны нелинейно. Нелинейность между ними можно исключить, если ввести новый признак ЭКЕ в квадрате.
Повторите шаги из пункта 1 и создайте вторую модель: подготовьте данные, обучите модель, оцените её качество и напишите выводы.
Добавьте в данные новый признак и обучите на них третью модель LinearRegression.
Добавьте признак Имя Папы из файла ferma_dad.csv, соединив его с остальными данными ferma_main.csv по ключу.
Устраните нелинейность между признаками.
Повторите шаги из пункта 1 и создайте третью модель: подготовьте данные, обучите модель, оцените её качество и напишите выводы.
Сравните качество трёх моделей линейной регрессии, сопоставьте их R² и остатки.
Оцените качество каждой модели по трём метрикам: MSE, MAE, RMSE. Используйте функции для расчёта метрик.
Выберите лучшую модель;
Укажите доверительный интервал прогноза лучшей модели. Для этого рассчитайте квантили ошибки модели на тренировочных данных.
С помощью лучшей модели спрогнозируйте удой коров, которых фермер хочет купить. Данные о них находятся в датасете cow_buy.csv.
Добавьте недостающие признаки ЭКЕ (Энергетическая кормовая единица), Сырой протеин, г и СПО (Сахаро-протеиновое соотношение): возьмите из датасета ferma_main.csv средние значения каждого из признаков и увеличьте их на 5%.
Выполните подготовку данных, аналогичную той, которую делали для тренировочной выборки.
Получите прогноз удоя коров.
Шаг 6. Задача классификации
Подготовьте данные датасета ferma_main.csv и обучите на них модель LogisticRegression.
Используйте в качестве целевого признак Вкус молока.
При необходимости преобразуйте имеющиеся или добавьте новые признаки.
Разбейте данные на тренировочную и тестовую выборки.
Кодируйте категориальные признаки с помощью OneHotEncoder.
Масштабируйте количественные признаки с помощью StandardScaler.
Обучите модель логистической регрессии на подготовленных данных.
Оцените качество модели на тестовой выборке: рассчитайте метрики accuracy, recall, precision.
Постройте матрицу ошибок.
Проанализируйте модель логистической регрессии.
Объясните, какая ошибка критичнее всего при покупке коров: первого или второго рода. Помните, что главное для заказчика — вкусное молоко. Сформулируйте ответ с учётом метрик recall и precision, выберите более важную из них.
Сведите критичную ошибку к нулю: для этого измените порог принадлежности к классам. Ещё раз рассчитайте значения метрик recall и precision. Какое значение порога вы выбрали? Как изменились значения метрик?
Оформите выводы: скажите, что нужно сделать дальше, исходя из анализа модели?
С помощью обученной модели спрогнозируйте вкус молока коров, которых фермер хочет купить. Данные о них находятся в датасете cow_buy.csv.
Выполните подготовку данных, аналогичную той, которую делали для тренировочной выборки.
Получите прогноз вкуса молока коров.
Шаг 7. Сделайте итоговые выводы
Добавьте прогнозы вкуса молока и удоя коров «ЭкоФермы» в датафрейм с коровами, покупку которых рассматривает фермер.
Отберите коров, для которых спрогнозирован удой более 6000 килограммов в год и вкусное молоко.
Коротко опишите результаты работы моделей для фермера.
Сколько коров он может купить из стада на продажу с минимальным риском для себя? Почему?
Какие ещё рекомендации можно ему дать?
Сделайте выводы о моделях линейной регрессии и логистической регрессии.
Какие способы улучшения качества регрессионной модели вы использовали в этой задаче?
Возможно ли ещё улучшить результаты регрессионной модели? Если можно, то как? Если нет, то почему?
Какие метрики моделей классификации, в том числе логистической регрессии, важны при анализе рисков или экономических расчётов?
Как будут проверять мой проект
Мы подготовили критерии оценки проекта, которыми руководствуются ревьюеры. Прежде чем приступить к решению кейса, внимательно их изучите. 
На что обращают внимание ревьюеры, проверяя проект:
как вы готовите данные к обучению, все ли особенности увидели и обрабатываете;
хорошо ли объясняете шаги по предобработке данных и исследовательскому анализу;
как проводите корреляционный анализ, проводите ли исследования в подгруппах;
используете ли при корреляционном анализе графики;
какие выводы об исследовании задачи делаете;
корректно ли разбиваете данные на выборки;
верно ли выбираете методы моделирования;
корректно ли проводите обучение;
корректно ли оцениваете модель по метрикам;
корректно ли исследуете остатки модели;
следите за структурой проекта и поддерживаете аккуратность кода;
правильно ли используете модели;
соблюдаете ли вы требования заказчика, даёте ли ему практические рекомендации.
Успехов!

# Технический комментарий
- Версия с опциональной критикой без правок
- Emerald